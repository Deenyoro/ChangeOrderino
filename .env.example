# ==========================================
# ChangeOrderino Environment Configuration
# ==========================================

# ============ GENERAL ============
COMPOSE_PROJECT_NAME=changeorderino
TZ=America/New_York  # Configurable in Settings
ENVIRONMENT=development

# Local/Development Domain
DOMAIN=localhost

# Public Domains (for Cloudflare Tunnel - see CLOUDFLARE TUNNEL section below)
PUBLIC_DOMAIN=changeorderino.yourdomain.com
PUBLIC_AUTH_DOMAIN=auth.yourdomain.com

# ============ DATABASE ============
POSTGRES_USER=changeorderino
POSTGRES_PASSWORD=changeme_strong_password
POSTGRES_DB=changeorderino
POSTGRES_KEYCLOAK_DB=keycloak

DATABASE_URL=postgresql+asyncpg://changeorderino:changeme_strong_password@db:5432/changeorderino
DB_POOL_SIZE=20
DB_MAX_OVERFLOW=0

# ============ REDIS ============
REDIS_URL=redis://redis:6379/0

# ============ MINIO (S3 Storage) ============
MINIO_ROOT_USER=minioadmin
MINIO_ROOT_PASSWORD=changeme_minio_password
MINIO_BUCKET_NAME=changeorders
MINIO_SECURE=false
MINIO_SERVER_URL=http://minio:9000
MINIO_EXTERNAL_URL=http://localhost:9000

# ============ API ============
API_HOST=0.0.0.0
API_PORT=8000
VITE_API_URL=/api
CORS_ORIGINS=http://localhost:3000,http://localhost:3443,https://localhost:3443

# ============ SECURITY ============
JWT_SECRET=changeme_jwt_secret_key_min_32_chars
JWT_ALGORITHM=HS256
JWT_EXPIRE_MINUTES=60
MAX_UPLOAD_SIZE=10485760

# ============ KEYCLOAK ============
AUTH_ENABLED=true
VITE_AUTH_ENABLED=true

KEYCLOAK_ADMIN=admin
KEYCLOAK_ADMIN_PASSWORD=changeme_keycloak_admin_password

KEYCLOAK_REALM=changeorderino
KEYCLOAK_CLIENT_ID=changeorderino-app
KEYCLOAK_CLIENT_SECRET=changeme_keycloak_client_secret

# Backend uses internal Docker hostname
KEYCLOAK_SERVER_URL=http://keycloak:8080
KEYCLOAK_REALM_URL=http://keycloak:8080/realms/changeorderino

# Frontend uses public domain (must be browser-accessible)
VITE_KEYCLOAK_URL=https://localhost:8443
VITE_KEYCLOAK_REALM=changeorderino
VITE_KEYCLOAK_CLIENT_ID=changeorderino-app

# ============ EMAIL (Office 365 SMTP) ============
# Change Order Email Configuration
# Note: This SMTP is specifically for change order notifications
# Future modules (e.g., invoicing, scheduling) may use different SMTP accounts
# Auth: Licensed user noreply@treconstruction.net with Send As permission on changeorder@treconstruction.net
SMTP_ENABLED=true  # Configurable in Settings
SMTP_HOST=smtp.office365.com  # Configurable in Settings
SMTP_PORT=587  # Configurable in Settings
SMTP_USE_TLS=true  # Configurable in Settings
SMTP_USERNAME=noreply@treconstruction.net  # Configurable in Settings
SMTP_PASSWORD=changeme_email_password  # NOT configurable in Settings (security)
SMTP_FROM_EMAIL=changeorder@treconstruction.net  # Configurable in Settings
SMTP_FROM_NAME=TRE Construction Change Orders  # Configurable in Settings

# ============ COMPANY INFO ============
# Configurable in Settings page
COMPANY_NAME=TRE Construction
COMPANY_EMAIL=changeorder@treconstruction.net
COMPANY_PHONE=555-123-4567

# ============ CHANGE ORDER SETTINGS ============
# All settings in this section are:
# - Configurable in Settings page (global defaults)
# - Can be overridden per Project
# - Can be overridden per Change Order

# Default OH&P percentages
DEFAULT_MATERIAL_OHP=15
DEFAULT_LABOR_OHP=20
DEFAULT_EQUIPMENT_OHP=10
DEFAULT_SUBCONTRACTOR_OHP=5

# Labor rates ($ per hour)
RATE_PROJECT_MANAGER=91
RATE_SUPERINTENDENT=82
RATE_CARPENTER=75
RATE_LABORER=57

# Reminder settings
REMINDER_ENABLED=true
REMINDER_INTERVAL_DAYS=7
REMINDER_MAX_RETRIES=4

# Token expiration for GC approval links (hours)
APPROVAL_TOKEN_EXPIRATION_HOURS=168

# ============ SETTINGS BEHAVIOR ============
# If true, always use .env values instead of database settings
# Set to false (default) to allow Settings page to override these values
# Set to true if you want .env to always be the source of truth
PREFER_ENV_SETTINGS=false

# ============ CLOUDFLARE TUNNEL (Optional) ============
# Use Cloudflare Tunnel for secure public access without port forwarding
#
# Setup steps:
# 1. Create a Cloudflare account and add your domain
# 2. Install cloudflared CLI: https://developers.cloudflare.com/cloudflare-one/connections/connect-apps/install-and-setup/
# 3. Create a tunnel: cloudflared tunnel create changeorderino
# 4. Configure tunnel routes in Cloudflare Zero Trust dashboard:
#    - Frontend: https://changeorderino.yourdomain.com -> http://frontend:80
#    - Keycloak: https://auth.yourdomain.com -> http://keycloak:8080
# 5. Copy the tunnel token from Zero Trust dashboard
# 6. Update PUBLIC_DOMAIN and PUBLIC_AUTH_DOMAIN above to match your domains
# 7. Update these variables below:
#    - VITE_KEYCLOAK_URL=https://auth.yourdomain.com
#    - CORS_ORIGINS=https://changeorderino.yourdomain.com,https://auth.yourdomain.com
# 8. Start with auth profile: docker compose --profile auth up -d
#
# See docs/CLOUDFLARE-TUNNEL-SETUP.md for detailed instructions
#
# Cloudflare Tunnel Token (from Zero Trust dashboard)
CLOUDFLARE_TUNNEL_TOKEN=
#
# Note: KEYCLOAK_SERVER_URL should remain http://keycloak:8080 (internal Docker network)
#       VITE_KEYCLOAK_URL should be your public domain (browser-accessible)
